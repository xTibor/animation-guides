<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=576, initial-scale=1">
        <style>
            html {
                touch-action: manipulation;
            }

            body {
                background: #EEEEEE;
                overflow: hidden;
            }

            #stopwatch_container {
                position: absolute;
                top: 50%;
                left: 50%;
                max-width: 576px;
                max-height: 576px;
                aspect-ratio: 1 / 1;
                transform: translate(-50%, -50%);
            }

            @media (min-aspect-ratio: 1 / 1) { #stopwatch_container { height: 100%; } }
            @media (max-aspect-ratio: 1 / 1) { #stopwatch_container { width:  100%; } }

            #stopwatch_container img {
                position: absolute;
                width: 100%;
                height: 100%;
                user-select: none;
                transition: inherit;
            }
        </style>
        <script>
            const stopwatch_default_style = "janica";

            const stopwatch_styles = {
                "janica": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"        ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-5.svg"         ],
                    ],
                    "hands": [
                        [30.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [ 6.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-01": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"        ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-7.svg"         ],
                    ],
                    "hands": [
                        [60.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [ 6.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-02": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"        ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-1.svg"         ],
                    ],
                    "hands": [
                        [180.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-black.svg" ],
                        [ 30.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [  6.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-03": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"        ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-4.svg"         ],
                    ],
                    "hands": [
                        [360.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-black.svg" ],
                        [ 60.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [  6.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-04": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"        ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-6.svg"         ],
                    ],
                    "hands": [
                        [360.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-black.svg" ],
                        [ 60.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [  6.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-05": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"         ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-60s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-3.svg"          ],
                    ],
                    "hands": [
                        [ 1.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [60.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ]
                },
                "alt-06": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"         ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-10s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-7.svg"          ],
                    ],
                    "hands": [
                        [60.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [10.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ]
                },
                "alt-07": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"         ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-10s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-2.svg"          ],
                    ],
                    "hands": [
                        [360.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-black.svg" ],
                        [ 60.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [ 10.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ]
                },
                "alt-08": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"        ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-8.svg"         ],
                    ],
                    "hands": [
                        [30.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [ 6.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-09": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"        ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-9.svg"         ],
                    ],
                    "hands": [
                        [60.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [ 6.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-10": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"        ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-10.svg"        ],
                    ],
                    "hands": [
                        [60.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [ 6.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-11": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"        ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg"],
                        [[0.0, 0.0], "dial-inner/stopwatch-dial-inner-3.svg"         ],
                    ],
                    "hands": [
                        [24.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-black.svg" ],
                        [ 1.0, 0.0, [0.0, 0.0], "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        [ 6.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-12": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"         ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-24s-1.svg"],
                    ],
                    "hands": [
                        [24.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-maroon.svg"],
                        [ 1.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-13": {
                    "dials": [
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-bg.svg"         ],
                        [[0.0, 0.0], "dial-outer/stopwatch-dial-outer-24fps-24s-2.svg"],
                    ],
                    "hands": [
                        [24.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-maroon.svg"],
                        [ 1.0, 0.0, [0.0, 0.0], "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
            };

            const viewbox_correction_param = "#svgView(viewBox(-2,-2,156.4 156.4))";
            const viewbox_correction_scale = 152.4 / 156.4;

            function position_to_transform(position) {
                const [position_x, position_y] = position;

                if ((position_x != 0.0) || (position_y != 0.0)) {
                    const corrected_position_x = position_x * viewbox_correction_scale / 2.0;
                    const corrected_position_y = position_y * viewbox_correction_scale / 2.0;
                    return `translate(${corrected_position_x}%, ${corrected_position_y}%) `;
                } else {
                    return "";
                }
            }

            let stopwatch_state, stopwatch_style, stopwatch_start, stopwatch_request;

            function stopwatch_initialize() {
                cancelAnimationFrame(stopwatch_request);

                stopwatch_state = 0;
                stopwatch_style = null;
                stopwatch_start = null;
                stopwatch_request = null;

                stopwatch_reload_style();
                stopwatch_set_elapsed_time(0.0);
            }

            function $(id) {
                return document.getElementById(id);
            }

            function stopwatch_set_elapsed_time(t) {
                for (const [hand_index, [hand_sweep, hand_phase, hand_position, hand_url]] of stopwatch_styles[stopwatch_style]["hands"].entries()) {
                    let stopwatch_hand_transform = "";

                    stopwatch_hand_transform += position_to_transform(hand_position);

                    {
                        const angle = ((t / 1000.0) / hand_sweep * 360.0 + hand_phase) % 360.0;
                        stopwatch_hand_transform += `rotate(${angle}deg) `;
                    }

                    $(`stopwatch_hand_${hand_index}`).style.transform = stopwatch_hand_transform;
                }
            }

            function stopwatch_tick() {
                stopwatch_request = requestAnimationFrame(stopwatch_tick);
                stopwatch_set_elapsed_time(performance.now() - stopwatch_start);
            }

            function stopwatch_input() {
                switch (stopwatch_state) {
                    case 0:
                        stopwatch_start = performance.now();
                        stopwatch_request = requestAnimationFrame(stopwatch_tick);
                        $("stopwatch_container").style.transition = "none";
                        stopwatch_state = 1;
                        break;
                    case 1:
                        cancelAnimationFrame(stopwatch_request);
                        stopwatch_state = 2;
                        break;
                    case 2:
                        stopwatch_set_elapsed_time(0.0);
                        $("stopwatch_container").style.transition = "0.1s transform";
                        stopwatch_state = 0;
                        break;
                }
            }

            function stopwatch_reload_style() {
                if (window.location.hash) {
                    stopwatch_style = window.location.hash.substring(1);
                    if (!(stopwatch_style in stopwatch_styles)) {
                        stopwatch_style = stopwatch_default_style;
                    }
                } else {
                    stopwatch_style = stopwatch_default_style;
                }

                $("stopwatch_container").replaceChildren();

                for (const [dial_position, dial_url] of stopwatch_styles[stopwatch_style]["dials"]) {
                    let dial_elem = document.createElement('img');
                    dial_elem.src = dial_url + viewbox_correction_param;
                    dial_elem.style.transform = position_to_transform(dial_position);
                    dial_elem.draggable = false;
                    $("stopwatch_container").appendChild(dial_elem);
                }

                for (const [hand_index, [hand_sweep, hand_phase, hand_position, hand_url]] of stopwatch_styles[stopwatch_style]["hands"].entries()) {
                    let hand_elem = document.createElement('img');
                    hand_elem.id = `stopwatch_hand_${hand_index}`;
                    hand_elem.src = hand_url + viewbox_correction_param;
                    hand_elem.draggable = false;
                    $("stopwatch_container").appendChild(hand_elem);
                }
            }

            window.addEventListener("load", (e) => {
                stopwatch_initialize();

                window.addEventListener("hashchange", stopwatch_initialize);
                document.addEventListener("keypress", stopwatch_input);
                $("stopwatch_container").addEventListener("click", stopwatch_input);
            });
        </script>
    </head>
    <body>
        <div id="stopwatch_container"></div>
    </body>
</html>
