<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=576, initial-scale=1">
        <style>
            html {
                touch-action: manipulation;
            }

            body {
                background: #FFFFFF;
                overflow: hidden;
            }

            #stopwatch_container {
                position: absolute;
                width: 100%;
                height: 100%;
                max-width: 576px;
                max-height: 576px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            #stopwatch_container img {
                position: absolute;
                width: 100%;
                height: 100%;
                user-select: none;
                transition: inherit;
            }
        </style>
        <script>
            const stopwatch_default_style = "janica";

            const stopwatch_styles = {
                "janica": {
                    "dials": [
                        "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg",
                        "dial-inner/stopwatch-dial-inner-1.svg",
                    ],
                    "hands": [
                        ["hand_inner", 30.0, "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        ["hand_outer",  6.0, "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-01": {
                    "dials": [
                        "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg",
                        "dial-inner/stopwatch-dial-inner-4.svg",
                    ],
                    "hands": [
                        ["hand_inner", 60.0, "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        ["hand_outer",  6.0, "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-02": {
                    "dials": [
                        "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg",
                        "dial-inner/stopwatch-dial-inner-1.svg",
                    ],
                    "hands": [
                        ["hand_inner_1", 180.0, "hand-inner/stopwatch-hand-inner-black.svg" ],
                        ["hand_inner_2",  30.0, "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        ["hand_outer",     6.0, "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-03": {
                    "dials": [
                        "dial-outer/stopwatch-dial-outer-24fps-6s-1.svg",
                        "dial-inner/stopwatch-dial-inner-4.svg",
                    ],
                    "hands": [
                        ["hand_inner_1", 360.0, "hand-inner/stopwatch-hand-inner-black.svg" ],
                        ["hand_inner_2",  60.0, "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        ["hand_outer",     6.0, "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ],
                },
                "alt-04": {
                    "dials": [
                        "dial-outer/stopwatch-dial-outer-24fps-60s-1.svg",
                        "dial-inner/stopwatch-dial-inner-3.svg",
                    ],
                    "hands": [
                        ["hand_inner",  1.0, "hand-inner/stopwatch-hand-inner-maroon.svg"],
                        ["hand_outer", 60.0, "hand-outer/stopwatch-hand-outer-red.svg"   ],
                    ]
                },
            };

            let stopwatch_state = 0;
            let stopwatch_style = null;
            let stopwatch_start = null;
            let stopwatch_timer = null;

            function $(id) {
                return document.getElementById(id);
            }

            function stopwatch_set_elapsed_time(t) {
                for (const [hand_id, hand_cycle, hand_url] of stopwatch_styles[stopwatch_style]["hands"]) {
                    $(hand_id).style.transform = `rotate(${((t / 1000.0) / hand_cycle * 360.0) % 360.0}deg)`;
                }
            }

            function stopwatch_input() {
                switch (stopwatch_state) {
                    case 0:
                        stopwatch_start = Date.now();
                        stopwatch_timer = setInterval(() => {
                            stopwatch_set_elapsed_time(Date.now() - stopwatch_start);
                        }, 16);
                        $("stopwatch_container").style.transition = "none";
                        stopwatch_state = 1;
                        break;
                    case 1:
                        clearInterval(stopwatch_timer);
                        stopwatch_state = 2;
                        break;
                    case 2:
                        stopwatch_set_elapsed_time(0.0);
                        $("stopwatch_container").style.transition = "0.1s transform";
                        stopwatch_state = 0;
                        break;
                }
            }

            function stopwatch_reload_style() {
                if (window.location.hash) {
                    stopwatch_style = window.location.hash.substring(1);
                    if (!(stopwatch_style in stopwatch_styles)) {
                        stopwatch_style = stopwatch_default_style;
                    }
                } else {
                    stopwatch_style = stopwatch_default_style;
                }

                const viewbox_correction = "#svgView(viewBox(-2,-2,156.4 156.4))";
                $("stopwatch_container").replaceChildren();

                for (const dial_url of stopwatch_styles[stopwatch_style]["dials"]) {
                    let dial_elem = document.createElement('img');
                    dial_elem.src = dial_url + viewbox_correction;
                    dial_elem.draggable = false;
                    $("stopwatch_container").appendChild(dial_elem);
                }

                for (const [hand_id, hand_cycle, hand_url] of stopwatch_styles[stopwatch_style]["hands"]) {
                    let hand_elem = document.createElement('img');
                    hand_elem.id = hand_id;
                    hand_elem.src = hand_url + viewbox_correction;
                    hand_elem.draggable = false;
                    $("stopwatch_container").appendChild(hand_elem);
                }
            }

            window.addEventListener("load", (e) => {
                stopwatch_reload_style();
                stopwatch_set_elapsed_time(0.0);

                window.addEventListener("hashchange", stopwatch_reload_style);
                document.addEventListener("keypress", stopwatch_input);
                $("stopwatch_container").addEventListener("click", stopwatch_input);
            });
        </script>
    </head>
    <body>
        <div id="stopwatch_container"></div>
    </body>
</html>
